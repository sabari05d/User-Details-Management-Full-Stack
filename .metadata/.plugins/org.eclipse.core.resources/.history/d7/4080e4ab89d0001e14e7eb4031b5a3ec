package org.jsp.UserApp.Service;

import java.util.Optional;

import org.jsp.UserApp.Exception.IdNotFoundException;
import org.jsp.UserApp.Exception.InvalidCredentialException;
import org.jsp.UserApp.dao.AadharDao;
import org.jsp.UserApp.dao.UserDao;
import org.jsp.UserApp.dto.AadharCard;
import org.jsp.UserApp.dto.ResponseStructure;
import org.jsp.UserApp.dto.User;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Service;

@Service
public class AadharService {
	@Autowired
	private AadharDao aadharDao;
	@Autowired
	private UserDao userDao;

	public ResponseEntity<ResponseStructure<AadharCard>> saveAadhar(AadharCard card, int id) {
		Optional<User> user = userDao.findById(id);
		ResponseStructure<AadharCard> structure = new ResponseStructure<>();
		if (user.isPresent()) {
			User u = user.get();
			card.setUser(u);
			u.setAadharcard(card);
			structure.setData(aadharDao.saveAadhar(card, id));
			structure.setMessage("Aadhar Card Saved Successfully");
			structure.setStatusCode(HttpStatus.CREATED.value());
			return new ResponseEntity<ResponseStructure<AadharCard>>(structure, HttpStatus.CREATED);
		}
		throw new IdNotFoundException();
	}

	public ResponseEntity<ResponseStructure<AadharCard>> updateAadharCard(AadharCard card) {
		Optional<AadharCard> resCard = aadharDao.findById(card.getId());
		ResponseStructure<AadharCard> structure = new ResponseStructure<>();
		if (resCard.isPresent()) {
			AadharCard card1 = resCard.get();
			card1.setAadhar_no(card.getAadhar_no());
			card1.setFatherName(card.getFatherName());
			card1.setGender(card.getGender());
			card1.setNationality(card.getNationality());
			card1.setPincode(card.getPincode());
			structure.setData(card1);
			structure.setMessage("AadharCard Updated with The Id Of : " + card1.getId());
			structure.setStatusCode(HttpStatus.ACCEPTED.value());
			return new ResponseEntity<ResponseStructure<AadharCard>>(structure, HttpStatus.ACCEPTED);
		}
		throw new IdNotFoundException();
	}

	public ResponseEntity<ResponseStructure<AadharCard>> findById(int id) {
		Optional<AadharCard> resCard = aadharDao.findById(id);
		ResponseStructure<AadharCard> structure = new ResponseStructure<>();
		if (resCard.isPresent()) {
			structure.setData(resCard.get());
			structure.setMessage("Valid Panacrd Id");
			structure.setStatusCode(HttpStatus.OK.value());
			return new ResponseEntity<ResponseStructure<AadharCard>>(structure, HttpStatus.OK);
		}
		throw new IdNotFoundException();
	}

	public ResponseEntity<ResponseStructure<AadharCard>> findByAadharNumber(long number) {
		Optional<AadharCard> resCard = aadharDao.findByNumber(number);
		ResponseStructure<AadharCard> structure = new ResponseStructure<>();
		if (resCard.isPresent()) {
			structure.setData(resCard.get());
			structure.setMessage("Valid Panacrd Number");
			structure.setStatusCode(HttpStatus.OK.value());
			return new ResponseEntity<ResponseStructure<AadharCard>>(structure, HttpStatus.OK);
		}
		throw new InvalidCredentialException("Invalid AAdhar Number");
	}

	public ResponseEntity<ResponseStructure<AadharCard>> findByFatherName(String fname) {
		Optional<AadharCard> resCard = aadharDao.findByFatherName(fname);
		ResponseStructure<AadharCard> structure = new ResponseStructure<>();
		if (resCard.isPresent()) {
			structure.setData(resCard.get());
			structure.setMessage("Valid FatherName To Find Aadhar");
			structure.setStatusCode(HttpStatus.OK.value());
			return new ResponseEntity<ResponseStructure<AadharCard>>(structure, HttpStatus.OK);
		}
		throw new InvalidCredentialException("Incorrect Father Name");
	}

	public ResponseEntity<ResponseStructure<AadharCard>> findAadharByUserEmail(String email) {
		Optional<AadharCard> resCard = aadharDao.findByUserEmail(email);
		ResponseStructure<AadharCard> structure = new ResponseStructure<>();
		if (resCard.isPresent()) {
			structure.setData(resCard.get());
			structure.setMessage("Valid User Email To Find Aadhar");
			structure.setStatusCode(HttpStatus.OK.value());
			return new ResponseEntity<ResponseStructure<AadharCard>>(structure, HttpStatus.OK);
		}
		throw new InvalidCredentialException("Incorrect User Email");
	}

	public ResponseEntity<ResponseStructure<AadharCard>> verifyByEmailAndpassword(String email, String password) {
		Optional<AadharCard> resCard = aadharDao.verifyAadharByUserEmail(email, password);)
		ResponseStructure<AadharCard> structure = new ResponseStructure<>();
		if (resCard.isPresent()) {
			structure.setData(resCard.get());
			structure.setMessage("Verified Successfully");
			structure.setStatusCode(HttpStatus.OK.value());
			return new ResponseEntity<ResponseStructure<AadharCard>>(structure, HttpStatus.OK);
		}
		throw new InvalidCredentialException("Invalid User Email or Password");
	}

	public ResponseEntity<ResponseStructure<AadharCard>> findUserByNumber(long number) {
		Optional<AadharCard> resCard = aadharDao.findUserByAadhar(number);
		ResponseStructure<AadharCard> structure = new ResponseStructure<>();
		if (resCard.isPresent()) {
			structure.setData(resCard.get());
			structure.setMessage("User Found");
			structure.setStatusCode(HttpStatus.OK.value());
			return new ResponseEntity<ResponseStructure<AadharCard>>(structure, HttpStatus.OK);
		}
		throw new InvalidCredentialException("Incorrect Aadhar Number");

	}
}
