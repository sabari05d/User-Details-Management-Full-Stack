package org.jsp.UserApp.Service;

import java.util.Optional;

import org.jsp.UserApp.Exception.IdNotFoundException;
import org.jsp.UserApp.Exception.InvalidCredentialException;
import org.jsp.UserApp.dao.AadharDao;
import org.jsp.UserApp.dao.UserDao;
import org.jsp.UserApp.dto.AadharCard;
import org.jsp.UserApp.dto.ResponseStructure;
import org.jsp.UserApp.dto.User;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Service;

@Service
public class AadharService {
	@Autowired
	private AadharDao aadharDao;
	@Autowired
	private UserDao userDao;

	public ResponseEntity<ResponseStructure<AadharCard>> saveAadhar(AadharCard card, int id) {
		Optional<User> resUser = userDao.findById(id);
		ResponseStructure<AadharCard> structure = new ResponseStructure<>();
		if (resUser.isPresent()) {
			User user = resUser.get();
			card.setUser(user);
			user.setAadharcard(card);
			structure.setData(aadharDao.saveAadhar(card, id));
			structure.setMessage("Aadhar Card Saved Successfully");
			structure.setStatusCode(HttpStatus.CREATED.value());
			return new ResponseEntity<ResponseStructure<AadharCard>>(structure, HttpStatus.CREATED);
		}
		throw new IdNotFoundException();
	}

	public ResponseEntity<ResponseStructure<AadharCard>> updateAadharCard(AadharCard card) {
		Optional<AadharCard> resCard = aadharDao.findById(card.getId());
		ResponseStructure<AadharCard> structure = new ResponseStructure<>();
		if (resCard.isPresent()) {
			AadharCard aadhar = resCard.get();
			aadhar.setName(card.getName());
			aadhar.setNumber(card.getNumber());
			aadhar.setAddress(card.getAddress());
			aadhar.setGender(card.getGender());
			aadhar.setPincode(card.getPincode());
			aadhar.setCity(card.getCity());
			aadhar.setState(card.getState());
			structure.setData(aadhar);
			structure.setMessage("AadharCard Updated Succesfully!!");
			structure.setStatusCode(HttpStatus.ACCEPTED.value());
			return new ResponseEntity<ResponseStructure<AadharCard>>(structure, HttpStatus.ACCEPTED);
		}
		throw new IdNotFoundException();
	}

	public ResponseEntity<ResponseStructure<AadharCard>> findById(int id) {
		Optional<AadharCard> resCard = aadharDao.findById(id);
		ResponseStructure<AadharCard> structure = new ResponseStructure<>();
		if (resCard.isPresent()) {
			structure.setData(resCard.get());
			structure.setMessage("Valid Panacrd Id");
			structure.setStatusCode(HttpStatus.OK.value());
			return new ResponseEntity<ResponseStructure<AadharCard>>(structure, HttpStatus.OK);
		}
		throw new IdNotFoundException();
	}

	public ResponseEntity<ResponseStructure<AadharCard>> findByNumber(long number) {
		Optional<AadharCard> resCard = aadharDao.findByNumber(number);
		ResponseStructure<AadharCard> structure = new ResponseStructure<>();
		if (resCard.isPresent()) {
			structure.setData(resCard.get());
			structure.setMessage("Valid Panacrd Number");
			structure.setStatusCode(HttpStatus.OK.value());
			return new ResponseEntity<ResponseStructure<AadharCard>>(structure, HttpStatus.OK);
		}
		throw new InvalidCredentialException("Invalid Aadhar Number");
	}

	public ResponseEntity<ResponseStructure<AadharCard>> findAadharByUserEmail(String email) {
		Optional<AadharCard> resCard = aadharDao.findAadharByUserEmail(email);
		ResponseStructure<AadharCard> structure = new ResponseStructure<>();
		if (resCard.isPresent()) {
			structure.setData(resCard.get());
			structure.setMessage("AadharCard Found!!");
			structure.setStatusCode(HttpStatus.OK.value());
			return new ResponseEntity<ResponseStructure<AadharCard>>(structure, HttpStatus.OK);
		}
		throw new InvalidCredentialException("Incorrect User Email");
	}

	public ResponseEntity<ResponseStructure<AadharCard>> verifyAadharByUserEmail(String email, String password) {
		Optional<AadharCard> resCard = aadharDao.verifyAadharByUserEmail(email, password);
		ResponseStructure<AadharCard> structure = new ResponseStructure<>();
		if (resCard.isPresent()) {
			structure.setData(resCard.get());
			structure.setMessage("AadharCard Found!!");
			structure.setStatusCode(HttpStatus.OK.value());
			return new ResponseEntity<ResponseStructure<AadharCard>>(structure, HttpStatus.OK);
		}
		throw new InvalidCredentialException("Invalid User Email or Password");
	}

	public ResponseEntity<ResponseStructure<AadharCard>> findUserByNumber(long number) {
		Optional<AadharCard> resCard = aadharDao.findAadharByUserPhone(number);
		ResponseStructure<AadharCard> structure = new ResponseStructure<>();
		if (resCard.isPresent()) {
			structure.setData(resCard.get());
			structure.setMessage("User Found");
			structure.setStatusCode(HttpStatus.OK.value());
			return new ResponseEntity<ResponseStructure<AadharCard>>(structure, HttpStatus.OK);
		}
		throw new InvalidCredentialException("Incorrect Aadhar Number");

	}
}
